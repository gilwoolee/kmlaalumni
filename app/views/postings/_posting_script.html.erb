<script type="text/javascript">
  
  $('body').on('click', 'a.read_more_link', function(event) {
    event.preventDefault();
    $(this).parent().next().show();
    $(this).parent().prev().remove();
    $(this).parent().remove();
  });
  
  $('body').on('click', 'a.get_more_comments_link', function(event) {
    event.preventDefault();
    $.ajax({
      url: this.href,
      type: 'get',
      dataType: 'script'
    });
  });
    
  $(document).ready( function() {
    var page = 1;
    var numPages = 0;
    var loading = true;
    
    function getNumPages() {
      $.ajax({
        url: '/postings/num_pages?' + <%= serialized_paginate_params %>,
        type: 'get',
        dataType: 'json',
        success: function(data) {
          numPages = data;
        }
      });
    }
    
    function appendNextPage() {
      $.ajax({
        url: '/postings/feed?' + <%= serialized_paginate_params %> + '&page=' + page,
        type: 'get',
        dataType: 'script',
        success: function() {
          loading = false;
        }
      });
    }
    
    function nearBottomOfPage() {
      return $(window).scrollTop() > $(document).height() - $(window).height() - 50;
    }
  
    getNumPages();
    appendNextPage();
    
    $(window).scroll(function(){
      if (page >= numPages || loading) {
        return;
      }

      if(nearBottomOfPage()) {
        loading=true;
        page++;
        appendNextPage();
      }
    });
  });
</script>
