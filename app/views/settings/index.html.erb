<div id='header'>
  <div class='header_title'><%= current_user.wave%>기 <%= current_user.name %></div>
</div>

<div id='settings_wrapper'>

<div id='basic_information_container' class='settings_container'>
  <div id='email_container' class='basic_information_section'>
    <div class='basic_information_category_title float-left'>이메일</div>
    <div id='email' class='basic_information_content float-left'><%= current_user.email %></div>
    <div class='float-right'><%= link_to "수정", '#', id: 'update_email_form_link', class: 'get_form_link' %></div>
  </div>
  <div id='update_email_container'>
    <div id='update_email_error_message'></div>
    <div id="update_email_form_link_container" class="get_form_container" style='display:none'>
      <%= render partial: 'settings/update_email_form' %>
    </div>
  </div>
</div>

<div id='educations_container' class='settings_container'>
  <div class='settings_category_title'>학교</div>
  <div id='educations'>
  <% for education in current_user.educations %>
    <div id="<%= 'education_' + education.id.to_s + '_container' %>">
      <%= render partial:'educations/education_with_update', locals:{education: education, display: false} %>
    </div>
  <% end %>
  </div>
  <div id='add_education_form_container'>
  </div>
  <div>
    <%= link_to '학교 추가하기', '#', id:'add_education_form_link' %>
  </div>
</div>

<div id='employments_container' class='settings_container'>
  <div class='settings_category_title'>직장</div>
  <div id='employments'>
  <% for employment in current_user.employments %>
    <div id="<%= 'employment_' + employment.id.to_s + '_container' %>">
      <%= render partial: 'employments/employment_with_update', locals:{employment: employment, display: false} %>
    </div>
  <% end %>
  </div>
  <div id='add_employment_form_container'>
  </div>
  <div>
    <%= link_to '직장 추가하기', '#',  id:'add_employment_form_link'%>
  </div>
</div>

<div id='password_container'>
  <div class='settings_category_title float-left'>비밀번호</div>
  <div class='float-right'><%= link_to "수정", '#', id: 'update_password_form_link', class: 'get_form_link' %></div>
</div>
<div id='update_password_container'>
  <div id='update_password_error_message'></div>
  <div id="update_password_form_link_container" class="get_form_container" style='display:none'>
    <%= render partial: 'settings/update_password_form' %>
  </div>
</div>

</div>
<script text="javascript">
  $(document).ready( function() {
    
    $('body').on('click', '.get_form_link', function(event) {
      event.preventDefault();
      if ($(this).html() == '수정') {
        $(this).html('닫기');
      } else {
        $(this).html('수정');
      }
      container_id = '#' + $(this).attr('id') + '_container';
      $(container_id).toggle();
    });
    
    $('body').on('click', '#add_education_form_link', function(event) {
      event.preventDefault();
      $(this).hide();
      $.ajax({
        url: '/get_add_education_form',
        type: 'get',
        dataType: 'html',
        success: function(data) {
           $('#add_education_form_container').html(data);
        }
      });
    });
    
    $('body').on('click', '#add_employment_form_link', function(event) {
      event.preventDefault();
      $(this).hide();
      $.ajax({
        url: '/get_add_employment_form',
        type: 'get',
        dataType: 'html',
        success: function(data) {
           $('#add_employment_form_container').html(data);
        }
      });
    });
    
    $('body').on('click', '.school_name_option', function(event) {
      event.preventDefault();
      $('#school_name_field').val($(this).html());
    });
    
    $('body').on('click', '.organization_name_option', function(event) {
      event.preventDefault();
      $('#organization_name_field').val($(this).html());
    });
    
    $('body').on('submit', '#add_education_form', function() {
      var valuesToSubmit = $('#add_education_form').serialize();
      $.ajax({
        url: $('#add_education_form').attr('action'), //submits it to the given url of the form
        data: valuesToSubmit,
        type: 'post',
        dataType: 'script' // you want a difference between normal and ajax-calls, and json is standard
      })
      $('#add_education_form_container').html('');
      $('#add_education_form_link').show();
      return false;
    });
    
    $('body').on('submit', '#add_employment_form', function() {
      var valuesToSubmit = $('#add_employment_form').serialize();
      $.ajax({
        url: $('#add_employment_form').attr('action'), //submits it to the given url of the form
        data: valuesToSubmit,
        type: 'post',
        dataType: 'script' // you want a difference between normal and ajax-calls, and json is standard
      })
      $('#add_employment_form_container').html('');
      $('#add_employment_form_link').show();
    });
    
  });
</script>
